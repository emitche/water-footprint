<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Water Footprint</title>
  <script src="js/jquery-1.11.3.min.js"></script>
  <script src="js/foods.js"></script>
  <script src="js/units.js"></script>
</head>

<body>
  <div class="water-footprint">
    <select class="select-item">
    </select>

    <div class="result">
    </div>

    <select class="select-item-2">
    </select>

    <div class="result-2">
      <div class="one-serving">
      </div>
    </div>
  </div>

  <script>
    // console.log(foods);

    var units = "gallons";
    var units_label = measuring_units[units].label;
    // console.log(units_label);

    // $.each(foods, function(food, food_info) {
    //   console.log(food_info.water_use[units]);
    // });

    // Load each food

    $.each(foods, function(food, food_info) {
      if (food_info.water_use.gallons) {
        $('.select-item').append(
          "<option class='item " + food + "' value='" + food + "'>"
          + food_info.food_name +
          "</option>"
        );
      }
    });

    // Display water use on user selection

    $('.select-item').on('change', function (e) {
      var choices = this;
      var item = $(choices).val();
      console.log(item);
      var item_amount = foods[item].water_use[units].serving;
      var water_use = foods[item].water_use[units].water;
      // var result = "<p>" + serving + " uses " + water_use + " " + units_label + "</p>";
      // var result = "<p class='item-amount'>" + item_amount + "</p><p>uses</p><p class='water-use'>" + water_use + " " + units_label + "</p><p>to produce</p>";
      var result = "<p class='item-amount'>" + item_amount + "</p><p class='water-use'>" + water_use + " " + units_label + "</p>";
      $(".result").html(result);
    });
  </script>

  <script>
    var base_unit = "litre";
    var display_unit = "gallon";

    // var units_label = measuring_units[units].label;

    var L_TO_GAL = 0.264172052358;
    var KG_TO_LB = 2.205;

    $.each(foods, function(food, food_info) {
      if (food_info.water_use.water_litres) {
        $('.select-item-2').append(
          "<option class='item " + food + "' value='" + food + "'>"
          + food_info.food_name +
          "</option>"
        );
      }
    });

    function convert_to_us_units(n) {
      n = n * L_TO_GAL / KG_TO_LB;
      n = Math.round(n);
      return n;
    }

    // Display water use on user selection

    $('.select-item-2').on('change', function (e) {
      var choices = this;
      var item_key = $(choices).val();
      console.log(item_key);
      var item = foods[item_key];
      var litre_info = item.water_use.water_litres;
      console.log(item);

      var heading = "<h1>" + item.food_name + "</h1>";
      var result;

      if (litre_info) {
        if (litre_info.per_kg) {
          console.log("bulk info available for " + item_key);
          var bulk = "<p>" + 1 + " kg = " + litre_info.per_kg + " litres of water" + "</p>";
          var bulk_gallons_lbs = "<p>" + 1 + " lb = " + convert_to_us_units(litre_info.per_kg) + " gallons of water" + "</p>";
          result = bulk + bulk_gallons_lbs;
        }

        // if (litre_info.per_serving) {
        //   console.log("serving info available for " + item_key);
        //   // var serving = "<p>" + litre_info.serving.description + " (" + litre_info.serving.weight + " grams) " + "uses" + litre_info.per_serving + " litres to produce" + "</p>";

        //   var serving = "<p>" + litre_info.serving.description + "</p>";
        //   result = bulk + serving;
        // }

      } else {
        console.log("Litres info not available for " + item_key);
        result = "<p>No information available.</p>"
      }

      $(".result-2").html(heading + result);
    });
  </script>

  <style>
    p {
      margin: 0;
      font-size: 1.1em;
    }

    .item-amount {
      font-size: 2.5em;
    }

    .water-use {
      font-size: 4em;
    }

    .item-amount, .water-use {
      font-weight: bold;
      text-transform: uppercase;
    }
  </style>
</body>
</html>
